{
  "project_name": "TaskFlow Bot",
  "theme": "分散タスク管理ボット",
  "description": "Discord上でチームのタスクを効率的に管理するために設計されたボットです。タスクのCRUD操作、担当者割り当て、期限設定などの基本的な機能に加え、ロールベースの権限管理や自動通知機能を備えています。Supabaseをバックエンドに採用し、データの永続化と信頼性を確保します。直感的なスラッシュコマンドとインタラクティブなUIにより、優れたユーザー体験を提供します。",
  "goal": "チーム開発や共同作業におけるタスク管理をDiscord内で完結させ、コミュニケーションと進捗管理の効率を向上させる実用的なボットを構築する。",
  "features": [
    "タスク管理: スラッシュコマンドによるタスクの追加、一覧表示、完了、削除、編集、詳細確認機能。",
    "データ永続化: Supabaseを利用し、ボットを再起動してもタスクや設定情報が失われない。",
    "権限管理: タスクの操作は作成者、担当者、または管理者ロールを持つユーザーに限定される。",
    "管理者機能: 管理者ロールを持つユーザーは、全てのタスクの操作とボットの設定変更が可能。",
    "自動通知: 期限が24時間以内に迫ったタスクを担当者のDMに通知するバックグラウンドタスク。",
    "期限切れ警告: 期限を過ぎたタスクを、サーバーごとに設定された特定のチャンネルに定期的に投稿する。",
    "インタラクティブUI: タスク一覧表示では、Embedとボタンを使用したページネーション機能を実装し、視認性と操作性を高める。",
    "設定機能: 管理者向けに、通知チャンネルや管理者ロール名などをサーバーごとに設定するコマンドを提供する。",
    "堅牢な設計: Cogによる機能分割、.envファイルによる設定管理、型ヒントの活用、適切なエラーハンドリングを実装する。"
  ],
  "commands": [
    {
      "name": "task_add",
      "display_name": "/task add",
      "description": "新しいタスクを作成します。",
      "category": "Task Management",
      "command_type": "slash",
      "parameters": [
        {
          "name": "title",
          "type": "str",
          "description": "タスクのタイトル",
          "required": true
        },
        {
          "name": "description",
          "type": "str",
          "description": "タスクの詳細な説明",
          "required": false
        },
        {
          "name": "assignee",
          "type": "user",
          "description": "タスクの担当者",
          "required": false
        },
        {
          "name": "due_date",
          "type": "str",
          "description": "タスクの期限 (例: 2023-12-31 23:59)",
          "required": false
        }
      ],
      "example": "/task add title: 新機能の実装 description: ユーザー認証機能を追加する assignee: @user due_date: 2024-01-15 18:00"
    },
    {
      "name": "task_list",
      "display_name": "/task list",
      "description": "タスクの一覧をEmbed形式で表示します。",
      "category": "Task Management",
      "command_type": "slash",
      "parameters": [
        {
          "name": "status",
          "type": "str",
          "description": "表示するタスクのステータス (todo, doing, done)",
          "required": false
        },
        {
          "name": "user",
          "type": "user",
          "description": "担当者でタスクを絞り込む",
          "required": false
        }
      ],
      "example": "/task list status: todo user: @user"
    },
    {
      "name": "task_detail",
      "display_name": "/task detail",
      "description": "指定したタスクの詳細情報を表示します。",
      "category": "Task Management",
      "command_type": "slash",
      "parameters": [
        {
          "name": "task_id",
          "type": "int",
          "description": "詳細を表示するタスクのID",
          "required": true
        }
      ],
      "example": "/task detail task_id: 12"
    },
    {
      "name": "task_done",
      "display_name": "/task done",
      "description": "指定したタスクを完了ステータスにします。",
      "category": "Task Management",
      "command_type": "slash",
      "parameters": [
        {
          "name": "task_id",
          "type": "int",
          "description": "完了にするタスクのID",
          "required": true
        }
      ],
      "example": "/task done task_id: 12"
    },
    {
      "name": "task_edit",
      "display_name": "/task edit",
      "description": "指定したタスクの情報を更新します。",
      "category": "Task Management",
      "command_type": "slash",
      "parameters": [
        {
          "name": "task_id",
          "type": "int",
          "description": "編集するタスクのID",
          "required": true
        },
        {
          "name": "title",
          "type": "str",
          "description": "新しいタスクのタイトル",
          "required": false
        },
        {
          "name": "description",
          "type": "str",
          "description": "新しいタスクの詳細な説明",
          "required": false
        },
        {
          "name": "status",
          "type": "str",
          "description": "新しいステータス (todo, doing, done)",
          "required": false
        },
        {
          "name": "assignee",
          "type": "user",
          "description": "新しい担当者",
          "required": false
        },
        {
          "name": "due_date",
          "type": "str",
          "description": "新しい期限 (例: 2024-01-20 18:00)",
          "required": false
        }
      ],
      "example": "/task edit task_id: 12 title: 新機能の仕様変更 assignee: @another_user"
    },
    {
      "name": "task_delete",
      "display_name": "/task delete",
      "description": "指定したタスクを削除します。",
      "category": "Task Management",
      "command_type": "slash",
      "parameters": [
        {
          "name": "task_id",
          "type": "int",
          "description": "削除するタスクのID",
          "required": true
        }
      ],
      "example": "/task delete task_id: 12"
    },
    {
      "name": "config",
      "display_name": "/config",
      "description": "サーバー固有のBot設定を行います（管理者のみ）。",
      "category": "Admin",
      "command_type": "slash",
      "parameters": [
        {
          "name": "notification_channel",
          "type": "channel",
          "description": "期限切れタスクの警告を投稿するチャンネル",
          "required": false
        },
        {
          "name": "admin_role",
          "type": "role",
          "description": "管理者として認識するロール",
          "required": false
        }
      ],
      "example": "/config notification_channel: #task-alerts admin_role: @TaskAdmin"
    }
  ],
  "persistence": "Supabase",
  "persistence_details": "SupabaseのPostgreSQLデータベースを使用。`tasks`テーブルと`guild_settings`テーブルを作成する。`tasks`テーブルにはID, タイトル, 説明, ステータス, 作成者ID, 担当者ID, 期限, 作成日時, 更新日時を格納。`guild_settings`テーブルにはサーバーIDと通知チャンネルID、管理者ロールIDを格納する。Pythonからは`supabase-py`ライブラリを介して非同期でアクセスする。",
  "external_apis": [
    {
      "name": "Supabase",
      "purpose": "タスクデータおよびサーバーごとの設定情報の永続化",
      "url": "https://supabase.com/",
      "auth_method": "Project URLとAnon KeyによるAPI認証",
      "env_var_name": "SUPABASE_URL, SUPABASE_KEY",
      "setup_guide": "Supabaseで新規プロジェクトを作成後、Project Settings > API にて Project URL と Project API Keys の anon (public) key を取得し、.envファイルに設定する。",
      "free_tier": "無料プランあり。データベース容量500MB、月間5万回のAPIコールなど、小〜中規模のプロジェクトには十分なリソースが提供される。"
    }
  ],
  "dependencies": [
    {
      "package": "discord.py",
      "version": "~=2.3.2",
      "purpose": "Discord Botを開発するための主要ライブラリ。"
    },
    {
      "package": "python-dotenv",
      "version": "~=1.0.0",
      "purpose": ".envファイルから環境変数を読み込むために使用。"
    },
    {
      "package": "supabase-py",
      "version": "~=2.3.0",
      "purpose": "PythonからSupabase APIを非同期で操作するために使用。"
    }
  ],
  "env_vars": [
    "DISCORD_BOT_TOKEN",
    "SUPABASE_URL",
    "SUPABASE_KEY"
  ],
  "constraints": [
    "discord.py 2.x以上を使用する。",
    "認証情報（トークン、APIキー）は.envファイルで管理し、コードにハードコードしない。",
    "Cogを用いて機能ごとにコードを分割し、main.pyの肥大化を防ぐ。",
    "コード全体に型ヒントを付与する。",
    "データベース接続やコマンド処理で発生する可能性のある例外を適切に処理し、Botがクラッシュしないようにする。",
    "タスクの編集・削除は、原則としてタスク作成者、担当者、または管理者ロールを持つユーザーのみが行える。"
  ],
  "non_goals": [
    "サブタスクやタスク間の依存関係の管理。",
    "ガントチャートなどの高度なプロジェクト管理機能の提供。",
    "Discord外のプラットフォーム（Web UIなど）との連携。",
    "複数サーバーを横断したタスク管理。"
  ],
  "assumptions": [
    "Botは単一のDiscordサーバー内でタスクを管理することを主眼とする。",
    "管理者ロールはDiscordのロール機能を利用して設定される。",
    "コマンドで入力される日付や時刻の文字列は、特定のフォーマット（例: YYYY-MM-DD HH:MM）に従うものとする。"
  ],
  "implementation_notes": [
    {
      "topic": "Cog Structure",
      "note": "機能を明確に分離するため、`cogs/task_commands.py`（タスク関連コマンド）、`cogs/admin_commands.py`（設定コマンド）、`cogs/notification_loop.py`（通知ループ）のようにファイルを分割することを推奨。データベース操作は`utils/db_manager.py`のような別ファイルに集約し、各Cogから呼び出す設計にすると見通しが良くなる。",
      "source": "discord.py documentation and general software design principles."
    },
    {
      "topic": "Paging with discord.ui.View",
      "note": "`/task list`のページング機能は`discord.ui.View`を継承したクラスで実装する。`@discord.ui.button`デコレータで「前へ」「次へ」ボタンを作成し、`interaction.response.edit_message`を呼び出してEmbedの内容を更新する。Viewのタイムアウト処理も適切に行うこと。",
      "source": "Official discord.py documentation on Views and UI components."
    },
    {
      "topic": "Background Tasks",
      "note": "期限通知機能は`discord.ext.tasks.loop`デコレータを使用して実装する。例えば60秒ごとにループを実行し、データベースをチェックして通知対象のタスクを探す。Botの起動時に`loop.start()`を呼び出すことを忘れないようにする。",
      "source": "Official discord.py documentation on background tasks."
    },
    {
      "topic": "Error Handling",
      "note": "データベース接続エラーは、DB操作を行う箇所で`try...except`ブロックで捕捉し、ユーザーにエラーメッセージを返すと同時にログに出力する。コマンドの引数エラーなどは、`on_application_command_error`イベントハンドラで集中的に処理するとコードが整理される。",
      "source": "discord.py documentation on error handling."
    },
    {
      "topic": "Database Schema",
      "note": "Supabaseでテーブルを作成する際、`id`は自動インクリメントの主キーに設定する。`creator_id`と`assignee_id`はDiscordのユーザーID（bigint）を格納する。`status`は`ENUM`型（'todo', 'doing', 'done'）または`TEXT`型で制約を設けると良い。`created_at`と`updated_at`は`timestamp with time zone`型にし、デフォルト値を`now()`に設定すると便利。",
      "source": "Supabase and PostgreSQL documentation."
    }
  ],
  "user_request": "チームで利用可能な実用レベルの分散タスク管理Discordボットの作成。主な機能として、タスクのCRUD、権限管理、期限通知が求められる。データ永続化にはSupabaseを使用し、Cog構成や.env利用など、クリーンで学習に適したコード設計であることが必須条件。"
}